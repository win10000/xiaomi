<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        form {
            position: relative;
        }

        span {
            position: absolute;
            top: -20px;
            color: red;
            display: none;
        }
    </style>
</head>

<body>
    <h1>登录/注册</h1>

    <form>
        <span>用户名或密码错误</span>

        用户名: <input type="text" class="username"><br>
        密码: <input type="text" class="password"><br>
    </form>

    <button>登录</button>
    <script src="../js/index.js"></script>
    <script>
        var nameInp = document.querySelector('.username')
        var passInp = document.querySelector('.password')
        var errorInfo = document.querySelector('span')

        // 1. 绑定事件
        var form = document.querySelector('form')
        // 1-1. 绑定表单提交事件
        form.onsubmit = function (e) {
            e = e || window.event
            e.preventDefault()

            // 2. 获取用户输入的内容
            var uname = nameInp.value
            var upass = passInp.value

            // 3. 表单验证
            //    非空验证
            //    格式验证 -> 正则
            if (!uname || !upass) {
                // 你没有填写 uname 或者 没有填写 upass
                // 就会执行这个 if 条件
                alert('请完整填写表单')
                // 这里表示没有完整填写表单, 后面的代码就没有必要执行了
                return
            }

            // 4. 发送一个带有参数的 POST 请求了
            postSend('./login.php', function (res) {
                // 这个函数就会在请求成功的时候调用
                // res 就是后端返回的响应体
                // console.log(res)
                var result = JSON.parse(res)
                if (result.code === 0) {
                    errorInfo.style.display = 'block'
                } else {
                    window.location.href = './cart.html'
                }

            }, `username=${uname}&password=${upass}`)

        }


    </script>
</body>

</html>